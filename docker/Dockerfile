FROM node:8

COPY . /app

WORKDIR /app

ARG API_HOST
ARG CONTENTFUL_API_HOST
ARG FACEBOOK_APP_ID
ARG GA_ID
ARG PIXEL_ID

ENV API_HOST="${API_HOST}" CONTENTFUL_API_HOST="${CONTENTFUL_API_HOST}" FACEBOOK_APP_ID="${FACEBOOK_APP_ID}" \
    GA_ID="$GA_ID" PIXEL_ID="$PIXEL_ID"

RUN yarn install && yarn run build && yarn cache clean

ENV NODE_ENV=production PORT=3001

EXPOSE 3001

CMD ["npm", "run", "start-production"]
